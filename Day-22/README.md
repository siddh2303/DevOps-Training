# Project 01

### 1) Configuring Jobs and Targets
#### Set up a Prometheus server to monitor multiple services running on different nodes.
- prometheus.yml
```
- job_name: "node_exporter"

    # metrics_path defaults to '/metrics'
    # scheme defaults to 'http'.

    static_configs:
      - targets: ["54.67.114.20:9100"]
```
### 2) Using Exporters (Node Exporter)
#### Use Node Exporter to monitor system-level metrics like CPU, memory, disk usage, and network statistics.
- Install Node Exporter On VM
```
wget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz
```
![](images/1.png)
```
tar -xvf node_exporter-1.8.2.linux-amd64.tar.gz
```
![](images/2.png)
### 3) Hands-on Exercise: Setting Up Exporters
#### Configure at least two different types of exporters (e.g., Node Exporter and MySQL Exporter) and integrate them with Prometheus.
- Install MySQL on VM
```
wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.15.1/mysqld_exporter-0.15.1.linux-amd64.tar.gz
```
![](images/3.png)
```
tar -xvf mysqld_exporter-0.15.1.linux-amd64.tar.gz
```
![](images/4.png)
- prometheus.yml to include mysql exporter.
```
- job_name: "mysql_exporter"
    static_configs:
      - targets: ["54.67.114.20:9104"]
``` 
### 4) Introduction to PromQL
#### Learn and implement basic PromQL queries to extract meaningful data from the metrics collected.
- Average CPU Usage
```
avg(rate(node_cpu_seconds_total{mode!="idle"}[1m])) by (instance)
```
![](images/5.png)
- Memory Consumption
```
node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes
```
![](images/6.png)
- Disk I/O
```
rate(node_disk_io_time_seconds_total[5m])
```
![](images/7.png)

### 5) Basic Queries (Selectors, Functions, Operators)
#### Create PromQL queries using selectors, functions, and operators to filter and manipulate time-series data.

- 95th Percentile CPU Usage
```
histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))
```
![](images/8.png)
- Rate of increase in a counter
```
increase(node_network_receive_bytes_total[5m])
```
![](images/9.png)
- Complex Analysis with function
```
rate(node_network_transmit_bytes_total[5m])
```
![](images/10.png)

### 6) Advanced Queries and Aggregations
#### Perform advanced data aggregation using PromQL.
- Total Memory Usage accross all nodes
```
sum(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes)
```
![](images/11.png)
- Maximum Disk Space Usage
```
max(node_filesystem_size_bytes - node_filesystem_free_bytes)
```
![](images/12.png)
### 7) Configuring Alertmanager
#### Set up Alertmanager to handle alerts generated by Prometheus.
- Configuring Alert manager inside prometheus.yml
```
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - 54.67.114.20:9093
rule_files:
  - "rules/my_rules.yml"
  - "rules/new_rule.yml"

```
### 8) Writing Alerting Rules
#### Write custom alerting rules in Prometheus to trigger alerts based on specific conditions.
- my_rules.yml
```
groups:
  - name: my-rules
    rules:
    - record: job:node_cpu_seconds:avg_idle
      expr: avg without(cpu)(rate(node_cpu_seconds_total{mode="idle"}[5m]))

    - alert: NodeExporterDown
      expr: up{job="node_exporter"} == 0
```
- new_rule.yml
```
groups:
- name: CPUAlerts
  rules:
  - alert: HighCPUUsage
    expr: sum(rate(node_cpu_seconds_total{mode!="idle"}[5m])) by (instance) > 0.9
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "High CPU usage on {{ $labels.instance }}"
      description: "CPU usage is above 90% for more than 5 minutes."
```
![](images/13.png)
### 9) Setting Up Notification Channels (Email, Slack, etc.)
#### Integrate Alertmanager with multiple notification channels like Email and Slack.
- alertmanager.yml
```
route:
  group_by: ['alertname']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 1h
  receiver: 'admin'
receivers:
- name: admin
  email_configs:
  - to: 'demouser@gmail.com'
    from: 'siddhpatel2303@gmail.com'
    smarthost: 'smtp.gmail.com:587'
    auth_username: 'siddhpatel2303@gmail.com'
    auth_identity: 'siddhpatel2303@gmail.com'
    auth_password: '********'
  slack_configs:
      - api_url: 'https://hooks.slack.com/services/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'
        channel: '#project'
inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'dev', 'instance']
```
![](images/14.png)
![](images/15.png)